<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reception App - Confirmation</title>
  <style>
    /* å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background-color: #ffffff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* ãƒ­ã‚´ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
    #logo {
      width: 100px;
      height: auto;
      margin: 1%;
      cursor: pointer;
      position: relative;
      animation: spin-stop 5s linear infinite; /* å›è»¢ã¨åœæ­¢ã‚’ç¹°ã‚Šè¿”ã™ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
      transition: transform 1s ease, opacity 1s ease; /* ã‚¿ãƒƒãƒ—æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    }

    /* å›è»¢ã¨é™æ­¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    @keyframes spin-stop {
      0% {
        transform: rotateY(0deg);
      }
      20% {
        transform: rotateY(0deg); /* 2å›è»¢ */
      }
      40% {
        transform: rotateY(720deg); /* é™æ­¢ */
      }
      100% {
        transform: rotateY(720deg); /* é™æ­¢ç¶­æŒ */
      }
    }

    .confirmation-box, .completion-box {
      background-color: #ffffff;
      width: 90%;
      max-width: 500px;
      padding: 20px 30px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.06);
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .message {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 20px;
      text-align: center;
      color: #333;
    }

    .info {
      font-size: 16px;
      margin-bottom: 30px;
      text-align: center;
      color: #555;
      word-break: break-word;
    }

    #call-button, #home-button {
      background-color: #4299e1;
      color: #ffffff;
      border: none;
      padding: 10px 20px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: background-color 0.3s, box-shadow 0.3s;
      width: 100%;
      max-width: 200px;
      margin-top: 20px;
    }

    #call-button:hover, #home-button:hover {
      background-color: #004085;
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* å®Œäº†ç”»é¢ã®åˆæœŸéè¡¨ç¤º */
    .completion-box {
      display: none;
    }
  </style>
</head>
<body>
  <img id="logo" src="images/logo.png" alt="Company Logo">

  <!-- ç¢ºèªç”»é¢ -->
  <div id="confirmation-box" class="confirmation-box">
    <div class="message">ã“ã®å†…å®¹ã§æ‹…å½“è€…ã‚’å‘¼ã³å‡ºã—ã¾ã™ã‹ï¼Ÿ</div>
    <div id="info" class="info"></div>
    <button id="call-button">å‘¼ã³å‡ºã—</button>
  </div>

  <!-- å®Œäº†ç”»é¢ -->
  <div id="completion-box" class="completion-box">
    <div class="message">å‘¼ã³å‡ºã—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚<br>æ‹…å½“è€…ãŒå‘ã‹ã„ã¾ã™ã®ã§ã€ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚</div>
    <button id="home-button">HOME</button>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const mode = urlParams.get('mode') || 'unknown';
    const companyName = urlParams.get('company') || 'æœªå…¥åŠ›';
    const visitorName = urlParams.get('name') || 'æœªå…¥åŠ›';

    const infoDiv = document.getElementById('info');
    const confirmationBox = document.getElementById('confirmation-box');
    const completionBox = document.getElementById('completion-box');
    const callButton = document.getElementById('call-button');
    const homeButton = document.getElementById('home-button');

    const slackWebhookUrl = 'http://localhost:3000/send-slack-notification';

    switch (mode) {
      case 'general':
        infoDiv.innerHTML = `
          <div>ä¼æ¥­å: ${companyName}</div>
          <div>æ°å: ${visitorName}</div>
        `;
        break;
      case 'interview':
        infoDiv.innerHTML = `
          <div>æ°å: ${visitorName}</div>
        `;
        break;
      case 'building':
        infoDiv.textContent = 'ãƒ“ãƒ«é–¢ä¿‚è€…æ§˜';
        break;
      case 'delivery':
        infoDiv.textContent = 'é…é€æ¥­è€…æ§˜';
        break;
      default:
        infoDiv.textContent = 'æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“';
    }

    callButton.addEventListener('click', () => {
      let message = '';

      // Slack ã«é€ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
      switch (mode) {
        case 'general':
          message = `<!channel>\næ¥è¨ªè€…ã®ã”å¯¾å¿œã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼\n\n----------------------------------------------\né …ã€€ç›®ï¼šç·åˆå—ä»˜\nä¼æ¥­åï¼š${companyName}\næ°ã€€åï¼š${visitorName}\n----------------------------------------------`;
          break;
        case 'interview':
          message = `<!channel>\né¢æ¥å¸Œæœ›è€…ã®ã”å¯¾å¿œã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼\n\n----------------------------------------------\né …ã€€ç›®ï¼šæ¡ç”¨é¢æ¥\næ°ã€€åï¼š${visitorName}\n----------------------------------------------`;
          break;
        case 'building':
          message = `<!channel>\nãƒ“ãƒ«é–¢ä¿‚è€…æ§˜ã®ã”å¯¾å¿œã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼âš `;
          break;
        case 'delivery':
          message = `<!channel>\né…é€æ¥­è€…æ§˜ã®ã”å¯¾å¿œã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼ğŸš›`;
          break;
        default:
          alert('é€šçŸ¥ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
          return;
      }

      // ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§ Slack ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
      fetch(slackWebhookUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text: message }),
      })
        .then((response) => {
          if (response.ok) {
            // ç¢ºèªç”»é¢ã‚’éè¡¨ç¤ºã«ã—ã¦å®Œäº†ç”»é¢ã‚’è¡¨ç¤º
            confirmationBox.style.display = 'none';
            completionBox.style.display = 'flex';
          } else {
            alert('é€šçŸ¥ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
          }
        })
        .catch((error) => {
          console.error('Fetch Error:', error);
          alert('é€šçŸ¥ã®é€ä¿¡ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
        });
    });

    homeButton.addEventListener('click', () => {
      window.location.href = 'index.html'; // TOPç”»é¢ã«é·ç§»
    });
  </script>
</body>
</html>
